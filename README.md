# visibleLightComm
CSC 591/791 (004); ECE 592 (054) Spring 2016: Internet of Things -- Architectures, Applications, and Implementation - Assignment 2

For this assignment, you will require an Arduino Uno, a Raspberry Pi, GPIO cable and Rasp PI breakout board, two computers/laptops with WiFi interfaces, an LED, a photodiode, some resisters. Their are two tasks of this assignment: (1) You type some text in a console window on one laptop and it appears in a console window in the other laptop in real-time while sending the data from one laptop to the other using the two IoT devices (Arduino and Rasp Pi). (2) You transfer arbitrary files (regardless of what the content or type of the file is) from laptop # 1 to laptop # 2 using the two IoT devices as quickly as possible (i.e., achieve high throughput). 

To enable transfer of data from one laptop to another using these two IoT devices, you have to establish a TCP connection between laptop # 1 and the Raspberry Pi. Laptop # 1 should initiate the TCP connection and the Raspberry Pi should listen for TCP connections. You decide the port numbers. You have to connect an LED with Raspberry Pi (search online and you will find a large number of tutorials on how to interface an LED with Raspberry PI). You will connect a photodiode with the ADC of your Arduino Uno (again search online and you will find a large number of tutorials on how to interface photodiode with Arduino Uno using ADC). Your Raspberry Pi will receive the data from laptop # 1 over the TCP connection and then transmit the bits of the payload of the received data through the LED, which will then be received by the Arduino Uno through the photodiode. The data that Raspberry PI receives from laptop # 1 can be trasnmitted through the LED by turning it on and off for 1 and 0 bits, respectively. As a toy example, suppose Raspberry Pi receives data that can be represented in binary format as 1101. You can decide an amount of time you allocate to transmit each bit. In this toy example, suppose we decide that we will allocate 10ms to transmit one bit. To transmit the 1101, you turn on the LED for 10ms to transmit the rightmost 1, then you turn off the LED for 10ms, which represents the transmission of 0, then you turn on the LED for 10ms to transmit the second 1 from the right, and finally you keep the LED on for another 10ms to transmit the leftmost 1. Now this transmitted data from Raspberry PI via the LED has to be received by the Arduino Uno via the photodiode connected to its ADC. Your Arduino Uno should sample the values from photodiode rapidly to determine whether the LED connected with Raspberry PI is transmitting a 1 or a 0. Note that the Arduino and Raspberry PI are not physically connected, which means that they need to synchronize so that the Arduino Uno knows exactly when the Raspberry Pi starts and ends transmitting a bit. This can be accomplised, for example by keeping the LED on for 500ms and then off for 500ms. Arduino board should continuously sample the values of photodiode connected to ADC to determine when the LED turned off after it has been on for a while and expect that the Raspberry Pi will start to transmit the first bit exactly after 500ms of the LED turning off, and then the duration of each bit is going to be 10ms. Please note that the values of 10ms and 500ms that I have used are only examples. Even the method of how to perform synchronziation is just a toy example. You should try to minimize these values to achieve high speed of transferring data from Raspberry Pi to Arduino Uno. You should also decide how to modulate the LED to transmit the data and how to synchronize it. You can use the simple method I described, but there are better ways this can be accomplished. Arduino Uno will be connected to the second laptop via the USB serial interface. 

Note that the bits you transmit from Raspberry Pi to Arduino Uno can get lost due to noise from ambient light. Therefore, you have to implement reliability in sending data from Raspberry Pi to Arduino via LED and Photodiode. This means that you have to design a header and packet format and encapsulate the data that the raspberry PI receives over the TCP connection from Laptop # 1 in that header and then transmit your packet from Raspberry Pi to Arduino via LED and photodiode. To achieve reliability, one the receiver has to be able to send ACKs, but in this case, Arduino can not transmit data back to Raspberry PI via LED because Arduino is not connected to an LED; only Raspberry Pi is. Although we can attach an LED to Arduino and a photodiode to Raspberry PI, to keep things simple, for sending the ACKs, the laptop number # 2 should establish a TCP connection with the Raspberry PI and send the ACKs to it over that TCP connection. For exmaple, suppose you use the following very simple header format: it only contains an 8 bit message ID. A very simple way of implementing reliability is that you decide on the maximum size of payload, such as 128 bits, that you will send in your packets through LED, choose a message ID such as 0x2F and trasmit the 128+8=136bits via LED. The arduino receives this 136-bit packet and sends it to the laptop # 2 via the USB serial interface. Your code on the laptop receives this packets, parses it and sends an 8-bit ACK message (with same message ID as the arriving packet) over the TCP connection it has with the Raspberry Pi (over WiFi). As soon as the Rasp Pi receives this ACK over the TCP connection, it then transmits another 136 bit packet to arduino via LED using (maybe) another message ID and waits for the ack of this 2nd packet over the TCP connection before sending the third packet out, and so on. There are a varierty of different protocols that you can use/adapt to achieve reliability. Please read Sections 3.4 and 3.5 of the following book to get an understanding of different methods of achieving reliability. Please note that your scenario is pretty straight forward, so you don't require very sophisticated reliability schemes. Just use the simplest one that can achieve reliability without compromising throughput from the Rasp Pi to Arduino Uno.

Note that you have to make a large number of design choices in completing this assignment, such as how to modulate the LED to transmit a 0 or a 1. How big a time slot should you use to transmit a 0 or a 1. How to synchronize Rasp Pi and Arduino Uno, what scheme to use to build reliability. What should be the format of the packet and header that you send from Rasp Pi to LED and what should be the format of ACK. I have deliberately not provided specific values for all such parameters because the purpose of this assignment is to help you see how different design choices can improve/degrade the thoughput you achieve.

You can use any programming language/environment you like.
